---
description: Present a final review of all generated single-environment CI/CD workflows for user approval before commit and push.
alwaysApply: false
---

# CICD Workflow Generation Phase 3: Review & Confirm

## Purpose

Provide the user with final review of the generated/updated CI/CD workflow files for all detected code types, including single-environment deployment pipelines, before confirming they are ready for commit and push (which happens in Phase 4).

## Steps

1. **Review Generated/Updated Workflows:**

   - Display comprehensive summary table:
     - Code type
     - Workflow file name (`{code-type}.yml`)
     - CI jobs in each workflow (lint, test, security scan)
     - Deployment job per workflow
     - Environment used
     - Main jobs/steps in each generated YAML
     - Workflow modifications (created/modified/removed)

   - Show actual YAML content for each workflow file:
     - `{code-type}.yml` - Workflow (CI + Deploy)

   - Present generated artifacts for review when available:
     - **Python**: Lint results, security scan results, test reports/coverage artifacts
     - **Terraform**: Security scan results, `tflint` output, Terraform plan artifact (if applicable)
     - **JavaScript/TypeScript**: Lint results, security scan results, test reports
     - **Java**: Build artifacts, lint results, security scan results
     - **Go**: Build binaries, lint results, security scan results
     - **Docker**: Container images, security scan results
     - **Kubernetes**: Manifest validation, security scan results
     - **CloudFormation**: Template validation, security scan results
     - **CDK**: Synthesis artifacts, security scan results

   - Provide quick highlights:
     - Single workflow structure (1 file per code type)
     - Branch-based deployment triggers (main branch)
     - Environment protection rules and approvals

   - Use clickable file links (preferably `@filename` syntax for Cursor, or relative/absolute paths) when presenting workflow file paths for review

2. **Review Dependency Handling:**

   - Verify dependency relationships from requirements analysis are correctly implemented:
     - Upstream workflows (dependencies) build and upload artifacts
     - Downstream workflows (dependents) wait for upstream workflows via `workflow_run` triggers
     - Artifact download steps are correctly configured in downstream workflows
     - Artifact paths/URLs are correctly passed to deployment steps
   - Review dependency map: `{code-type} → depends on → {other-code-type}`
   - Verify artifact passing mechanisms (GitHub Actions artifacts)
   - Confirm dependency order is correct (e.g., Python Lambda must be built before Terraform deployment)

3. **Review Deployment Flow:**

   - Verify workflow structure for each code type:
     - Workflow (`{code-type}.yml`) triggers on pushes to `main` branch (or waits for upstream dependencies via workflow_run)
   - Confirm `workflow_run` triggers with `branches: [main]` filter are correctly configured
   - Verify `workflow_run` condition checks (`if: github.event.workflow_run.conclusion == 'success'`) are in place
   - Verify code checkout from triggering workflow branch (`ref: ${{ github.event.workflow_run.head_branch }}`)
   - Verify environment protection rules are in place
   - **Verify dependency-based triggers**: If workflows have dependencies, ensure they wait for upstream workflows appropriately

4. **Review Workflow Generation Context:**

   - **If this was a regeneration**:
     - Indicate that `.github/workflows/` directory was deleted and all workflows were regenerated fresh
     - All workflows are newly generated (no modifications to existing workflows)
   - **If this was a new generation**:
     - Indicate that new workflows were generated
     - Any existing workflows with matching names were replaced
   - Confirm all generated workflows align with current codebase and detected code types

5. **Validate Workflow Linting:**

   - **CRITICAL**: Verify all generated workflow files have no linting errors
   - Check YAML syntax validity
   - Verify all GitHub Actions expressions use correct `${{ }}` syntax
   - Verify no missing required fields
   - Check for valid job dependencies and workflow triggers
   - **If linting errors are found**: Fix them immediately before proceeding to Phase 4
   - Report any linting errors found and confirm they are resolved

6. **User Confirmation:**
   - Ask user: "Are these workflow files ready for commit and push to the repository?"
   - On positive confirmation, proceed to Phase 4 (Commit & Push Changes).
   - On decline, permit user to abort or suggest edits to the workflows before proceeding to Phase 4.
   - **Update plan checkboxes** - Mark completed steps [x] in `.cicd-docs/review-notes.md`
   - **Update cicd-state.md** - Update Phase 3 status

**Note:** This phase is for review and approval only. Actual commit, push, and finalization occur in Phase 4.
